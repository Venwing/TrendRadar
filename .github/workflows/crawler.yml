name: Hot News Crawler

on:
  workflow_dispatch:
  schedule:
    - cron: "0 0 * * *"  
    # æ¯å¤©æ—©ä¸Š 8 ç‚¹ï¼ˆåŒ—äº¬æ—¶é—´ UTC+8ï¼‰

jobs:
  crawl:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: Install dependencies
      run: |
        pip install -r requirements.txt

    - name: Run TrendRadar crawler
      run: |
        python main.py

    - name: Upload output
      uses: actions/upload-artifact@v4
      with:
        name: news-output
        path: output/

    - name: Send Notification to WeChat (Serveré…±)
      run: |
        echo "ğŸ” è‡ªåŠ¨æŸ¥æ‰¾ output ä¸‹æœ€æ–°çš„æ¨é€æ–‡ä»¶..."

        FILE=$(ls output | grep -E ".md$|.txt$|.html$" | head -n 1)

        if [ -z "$FILE" ]; then
          echo "âŒ æœªæ‰¾åˆ°å¯å‘é€çš„æ–°é—»æ–‡ä»¶"
          exit 1
        fi

        echo "ğŸ“„ å°†å‘é€æ–‡ä»¶ï¼š$FILE"

        CONTENT=$(cat output/$FILE)

        curl -X POST "https://sctapi.ftqq.com/${{ secrets.SERVERCHAN_KEY }}.send" \
            -d "title=ä»Šæ—¥è¶‹åŠ¿çƒ­è®¯" \
            -d "desp=$CONTENT"
